{% extends "admin_panel_base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>Add Official Seeder Entry</h2>
    <form action="{{ url_for('add_official_seeder') }}" method="post" class="mb-3" id="seederForm" enctype="multipart/form-data">
        <div class="mb-3">
            <label for="full_name" class="form-label">Full Name</label>
            <input type="text" class="form-control" id="full_name" name="full_name" required>
        </div>
        <div class="mb-3">
            <label for="profile_picture" class="form-label">Profile Picture</label>
            <input type="file" class="form-control" id="profile_picture" name="profile_picture">
        </div>
        <div class="mb-3">
            <label for="alias" class="form-label">Alias</label>
            <input type="text" class="form-control" id="alias" name="alias">
        </div>
        <button type="submit" class="btn btn-primary">Add Entry</button>
    </form>

    <h2>Official Seeder List</h2>
    <table class="table">
        <thead>
            <tr>
                <th>Full Name</th>
                <th>Profile Picture</th>
                <th>Alias</th>
                <th>Facts</th>
                <th>Add Fact</th>
            </tr>
        </thead>
        <tbody>
            {% for seeder in seeders %}
            <tr>
                <td>{{ seeder.full_name }}</td>
                <td><img src="{{ seeder.profile_picture }}" alt="Profile Picture" style="width: 50px; height: 50px;"></td>
                <td>{{ seeder.alias }}</td>
                <td>
                    <ul>
                        {% for fact in seeder.facts %}
                        <li>{{ fact.fact_text }}</li>
                        {% endfor %}
                    </ul>
                </td>
                <td>
                    <input type="text" class="form-control mb-2" placeholder="New Fact" id="fact{{ seeder.id }}">
                    <button type="button" class="btn btn-secondary" onclick="addFact({{ seeder.id }})">Add Fact</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
function addFact(seederId) {
    const factInput = document.getElementById('fact' + seederId);
    const factText = factInput.value;
    if (factText.trim() !== '') {
        // Send a POST request to the server
        fetch('{{ url_for("add_fact_to_seeder") }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ seeder_id: seederId, fact_text: factText })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Append new fact to the list
                const factsList = factInput.parentNode.previousElementSibling.firstElementChild;
                const newFactItem = document.createElement('li');
                newFactItem.textContent = factText;
                factsList.appendChild(newFactItem);
                factInput.value = ''; // Clear the input
            } else {
                alert('Failed to add fact: ' + data.error);
            }
        });
    }
}
</script>

{% endblock %}



