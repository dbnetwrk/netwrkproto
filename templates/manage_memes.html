{% extends "admin_panel_base.html" %}
{% block content %}
<div class="container">
    <h1>Meme Management</h1>
    
    <!-- Add Meme Form -->
    <h2>Add New Meme</h2>
    <form action="{{ url_for('manage_memes') }}" method="post" enctype="multipart/form-data" id="memeForm">
        <div class="form-group">
            <label for="file">Meme Image:</label>
            <input type="file" class="form-control-file" id="file" name="file" required>
        </div>
        <div class="form-group">
            <label for="context">Meme Context:</label>
            <textarea class="form-control" id="context" name="context" required></textarea>
        </div>
        <div class="form-group">
            <label for="text_count">Number of Text Elements:</label>
            <input type="number" class="form-control" id="text_count" name="text_count" min="1" value="1" required>
        </div>
        <div id="textElements"></div>
        <button type="submit" name="add" class="btn btn-primary">Add Meme</button>
    </form>
    <!-- List of Existing Memes -->
    <h2 class="mt-5">Existing Meme Templates</h2>
    <div class="row">
        {% for meme in memes %}
        <div class="col-md-4 mb-4">
            <div class="card">
                <img src="{{ url_for('static', filename='memes/meme_templates/' + meme.image_filename) }}" class="card-img-top" alt="{{ meme.context }}">
                <div class="card-body">
                    <h5 class="card-title">Meme ID: {{ meme.id }}</h5>
                    <p class="card-text">{{ meme.context }}</p>
                    <p>Text Count: {{ meme.text_count }}</p>
                    <p>Font Types: {{ meme.font_types|join(', ') }}</p>
                    <p>Text Styles: {{ meme.text_styles|tojson }}</p>
                    <form action="{{ url_for('manage_memes') }}" method="post">
                        <input type="hidden" name="delete" value="{{ meme.id }}">
                        <button type="submit" class="btn btn-danger">Delete</button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
<script>
document.getElementById('text_count').addEventListener('change', function() {
    const count = parseInt(this.value);
    const container = document.getElementById('textElements');
    container.innerHTML = '';
    
    for (let i = 0; i < count; i++) {
        const div = document.createElement('div');
        div.className = 'form-row';
        div.innerHTML = `
            <div class="form-group col-md-2">
                <label for="font_type_${i}">Font Type:</label>
                <input type="text" class="form-control" id="font_type_${i}" name="font_type" required>
            </div>
            <div class="form-group col-md-2">
                <label for="x_${i}">X Position:</label>
                <input type="number" class="form-control" id="x_${i}" name="x_${i}" required>
            </div>
            <div class="form-group col-md-2">
                <label for="y_${i}">Y Position:</label>
                <input type="number" class="form-control" id="y_${i}" name="y_${i}" required>
            </div>
            <div class="form-group col-md-2">
                <label for="font_size_${i}">Font Size:</label>
                <input type="number" class="form-control" id="font_size_${i}" name="font_size_${i}" required>
            </div>
            <div class="form-group col-md-2">
                <label for="max_chars_${i}">Max Characters:</label>
                <input type="number" class="form-control" id="max_chars_${i}" name="max_chars_${i}" required>
            </div>
            <div class="form-group col-md-2">
                <label for="text_color_${i}">Text Color:</label>
                <input type="color" class="form-control" id="text_color_${i}" name="text_color_${i}" required>
            </div>
            <div class="form-group col-md-2">
                <label for="has_outline_${i}">Has Outline:</label>
                <select class="form-control" id="has_outline_${i}" name="has_outline_${i}" required>
                    <option value="true">Yes</option>
                    <option value="false">No</option>
                </select>
            </div>
            <div class="form-group col-md-2">
                <label for="outline_color_${i}">Outline Color:</label>
                <input type="color" class="form-control" id="outline_color_${i}" name="outline_color_${i}">
            </div>
        `;
        container.appendChild(div);
    }
});
</script>
{% endblock %}